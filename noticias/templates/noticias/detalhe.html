{% extends 'noticias/base.html' %}

{% block content %}
<div class="container" id="container-principal">
    
    <article class="artigo-principal" id="artigo-principal">
        
        <header class="artigo-header" id="header-artigo">
            {% if messages %}
                <div class="messages-container messages-artigo">
                    {% for message in messages %}
                        <p class="message {{ message.tags }}">{{ message }}</p>
                    {% endfor %}
                </div>
            {% endif %}

            <h1>{{ noticia.titulo }}</h1>
            <p class="artigo-meta" id="meta-artigo">
                Por: {{ noticia.autor.username }} em {{ noticia.data_publicacao|date:"d/m/Y H:i" }}
            </p>
        </header>

        <hr>

        
        <div class="modo-leitura-container" id="container-botao-modo">
            <button class="btn" id="btn-modo-leitura">
                Ativar modo de leitura
            </button>
        </div>

        <hr>

        <section class="conteudo-noticia" id="conteudo-artigo">
            {{ noticia.conteudo|safe }} 
        </section>

        <hr>

        <div class="artigo-acoes" id="acoes-artigo">
            {% if user.is_authenticated %}
                <form action="{% url 'salvar_noticia' noticia.id %}" method="POST">
                    {% csrf_token %}
                    
                    {% if salvo_para_depois %}
                        <button type="submit" class="btn btn-danger">Remover de Ler Mais Tarde</button>
                    {% else %}
                        <button type="submit" class="btn btn-primary">Salvar para Ler Mais Tarde</button>
                    {% endif %}
                </form>
            {% else %}
                <p class="login-prompt"><a href="{% url 'login' %}?next={{ request.path }}">Faça login</a> para salvar esta notícia.</p>
            {% endif %}
        </div>
    </article>

    <section class="secao-comentarios" id="comentarios-artigo">
        <hr class="section-divider">
        
        <h2>Deixe seu comentário</h2>

        {% if user.is_authenticated %}
            <form method="POST" class="form-comentario">
                {% csrf_token %}
                <textarea name="conteudo" rows="4" placeholder="Escreva seu comentário..." required></textarea>
                <button type="submit" class="btn btn-primary">Enviar Comentário</button>
            </form>
        {% else %}
            <p class="login-prompt"><a href="{% url 'login' %}?next={{ request.path }}">Faça login</a> para deixar um comentário.</p>
        {% endif %}

        <h3 class="titulo-comentarios">Comentários ({{ comentarios.count }})</h3>

        <div class="lista-comentarios">
            {% for comentario in comentarios %}
                <div class="comentario-card">
                    <p class="comentario-info">
                        <strong>{{ comentario.autor.username }}</strong>
                        <span class="comentario-data">em {{ comentario.data_criacao|date:"d/m/Y H:i" }}</span>
                    </p>
                    <p class="comentario-conteudo">{{ comentario.conteudo|linebreaksbr }}</p>
                </div>
            {% empty %}
                <p>Ainda não há comentários. Seja o primeiro a comentar!</p>
            {% endfor %}
        </div>
    </section>

</div>


<style>
    .modo-leitura-fullscreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: #ffffff;
        padding: 40px;
        overflow-y: auto;
        z-index: 9999;
    }

    .modo-leitura-conteudo {
        max-width: 800px;
        margin: 0 auto;
        font-size: 1.2em;
        line-height: 1.8em;
    }

    
    #btn-modo-leitura,
    .btn-sair-modo {
        background-color: #D10000; 
        border-color: #B30000;
        color: white;
        padding: 10px 16px;
        font-size: 1em;
        cursor: pointer;
    }

    .btn-sair-modo {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
    }
</style>


<script>
    const btnModoLeitura = document.getElementById('btn-modo-leitura');
    let modoAtivo = false;

    btnModoLeitura.addEventListener('click', () => {
        if(modoAtivo) return;

        modoAtivo = true;

       
        const leituraDiv = document.createElement('div');
        leituraDiv.id = 'leitura-fullscreen';
        leituraDiv.className = 'modo-leitura-fullscreen';

        
        const conteudoOriginal = document.getElementById('conteudo-artigo').cloneNode(true);

        
        conteudoOriginal.querySelectorAll('img').forEach(img => img.remove());

        leituraDiv.innerHTML = `
            <button class="btn btn-sair-modo" id="btn-sair-leitura">Sair do modo leitura</button>
            <div class="modo-leitura-conteudo"></div>
        `;

        leituraDiv.querySelector('.modo-leitura-conteudo').appendChild(conteudoOriginal);

        document.body.appendChild(leituraDiv);

        
        document.getElementById('btn-sair-leitura').addEventListener('click', () => {
            document.getElementById('leitura-fullscreen').remove();
            modoAtivo = false;
        });
    });
</script>
{% endblock %}